<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Neon Comet Stargazing</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at bottom, #0b1026 0%, #000000 100%); /* Bầu trời đêm có chiều sâu */
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

<canvas id="canvas"></canvas>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- CẤU HÌNH ---
    const STAR_COUNT = 300;      // Số lượng ngôi sao nền
    const COMET_COUNT = 5;       // Số lượng sao chổi xuất hiện cùng lúc
    const COMET_SPEED_MIN = 3;
    const COMET_SPEED_MAX = 30;
    const TRAIL_LENGTH = 40;     // Độ dài đuôi sao chổi

    function random(min, max) {
        return Math.random() * (max - min) + min;
    }

    // --- CLASS 1: NGÔI SAO NỀN (Lấp lánh) ---
    class Star {
        constructor() {
            this.x = random(0, width);
            this.y = random(0, height);
            this.size = random(0.5, 2);
            this.baseAlpha = random(0.3, 0.8); // Độ sáng gốc
            this.twinkleSpeed = random(0.02, 0.05);
            this.angle = random(0, Math.PI * 2);
        }

        update() {
            // Hiệu ứng lấp lánh (Sine wave)
            this.angle += this.twinkleSpeed;
            // Độ sáng dao động xung quanh mức gốc
            this.alpha = this.baseAlpha + Math.sin(this.angle) * 0.2;
            if (this.alpha < 0) this.alpha = 0;
        }

        draw() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
            ctx.fill();
        }
    }

    // --- CLASS 2: SAO CHỔI NEON (Nhân vật chính) ---
    class Comet {
        constructor() {
            this.reset();
        }

        reset() {
            // Xuất phát từ ngoài màn hình (Trên hoặc Trái)
            if (Math.random() < 0.5) {
                this.x = random(0, width);
                this.y = -50; // Trên cùng
            } else {
                this.x = -50; // Bên trái
                this.y = random(0, height / 2);
            }

            // Đích đến: Góc dưới phải (tạo cảm giác mưa sao băng chéo)
            this.speed = random(COMET_SPEED_MIN, COMET_SPEED_MAX);
            this.angle = random(Math.PI / 6, Math.PI / 3); // Góc bay chéo (30-60 độ)
            
            // Màu sắc Neon huyền ảo (Cyan, Purple, Blue, Pink)
            const hues = [180, 280, 220, 320]; 
            this.hue = hues[Math.floor(random(0, hues.length))];
            
            // Mảng lưu vết lịch sử để vẽ đuôi
            this.trail = [];
        }

        update() {
            // Lưu vị trí hiện tại vào lịch sử
            this.trail.push({ x: this.x, y: this.y });
            
            // Giới hạn độ dài đuôi
            if (this.trail.length > TRAIL_LENGTH) {
                this.trail.shift(); // Xóa điểm cũ nhất
            }

            // Di chuyển
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;

            // Nếu bay ra khỏi màn hình -> Reset lại từ đầu
            if (this.x > width + 500 || this.y > height + 500) {
                this.reset();
            }
        }

        draw() {
            // --- KỸ THUẬT VẼ ĐUÔI MỊN (GRADIENT TRAIL) ---
            if (this.trail.length < 2) return;

            // 1. Vẽ cái đuôi Neon
            ctx.beginPath();
            // Nối các điểm trong lịch sử lại
            ctx.moveTo(this.trail[0].x, this.trail[0].y);
            for (let i = 1; i < this.trail.length; i++) {
                // Kỹ thuật nối đường cong nhẹ để đuôi trông mềm mại
                // (Dù bay thẳng nhưng curve giúp khử răng cưa tốt hơn lineTo)
                let point = this.trail[i];
                ctx.lineTo(point.x, point.y);
            }
            
            // Tạo hiệu ứng đuôi mờ dần về phía sau
            // Gradient đi từ đuôi (trong suốt) -> đầu (sáng rõ)
            let gradient = ctx.createLinearGradient(
                this.trail[0].x, this.trail[0].y, 
                this.x, this.y
            );
            gradient.addColorStop(0, `hsla(${this.hue}, 100%, 50%, 0)`);
            gradient.addColorStop(1, `hsla(${this.hue}, 100%, 70%, 0.8)`);

            // Áp dụng ShadowBlur cho đuôi (Glow nhẹ)
            ctx.shadowBlur = 10;
            ctx.shadowColor = `hsl(${this.hue}, 100%, 50%)`;
            
            ctx.strokeStyle = gradient;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.stroke();

            // 2. Vẽ cái đầu (Nucleus) - Sáng nhất
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            
            // Đầu phát sáng mạnh mẽ
            ctx.shadowBlur = 20;
            ctx.shadowColor = `hsl(${this.hue}, 100%, 60%)`;
            ctx.fillStyle = '#fff'; // Tâm trắng
            ctx.fill();

            // Reset shadow
            ctx.shadowBlur = 0;
        }
    }

    // --- KHỞI TẠO ---
    let stars = [];
    for (let i = 0; i < STAR_COUNT; i++) {
        stars.push(new Star());
    }

    let comets = [];
    for (let i = 0; i < COMET_COUNT; i++) {
        comets.push(new Comet());
        // Random vị trí ban đầu cho trail có sẵn (đỡ bị giật lúc start)
        for(let j=0; j<TRAIL_LENGTH; j++) {
            comets[i].x += Math.cos(comets[i].angle) * comets[i].speed;
            comets[i].y += Math.sin(comets[i].angle) * comets[i].speed;
            comets[i].trail.push({x: comets[i].x, y: comets[i].y});
        }
    }

    function animate() {
        // Xóa sạch màn hình mỗi khung (Clear Canvas)
        // Vì sao chổi tự vẽ đuôi (trail) của nó rồi, nên ta không cần mẹo mờ màn hình nữa
        // Điều này giúp các ngôi sao nền luôn sắc nét, không bị nhòe.
        ctx.clearRect(0, 0, width, height);

        // 1. Vẽ nền sao
        stars.forEach(star => {
            star.update();
            star.draw();
        });

        // 2. Vẽ sao chổi
        // Dùng chế độ 'lighter' để đuôi sao chổi rực rỡ khi bay qua nhau
        ctx.globalCompositeOperation = 'lighter';
        comets.forEach(comet => {
            comet.update();
            comet.draw();
        });
        ctx.globalCompositeOperation = 'source-over';

        requestAnimationFrame(animate);
    }

    animate();

</script>

</body>
</html>
